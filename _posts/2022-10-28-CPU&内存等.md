---
layout: mypost
title: CPU和内存介绍
categories: [UEFI基础]
---

### 

| AMD Family | hex | Name          | Product                                                | Other                                             |
| ---------- | --- | ------------- | ------------------------------------------------------ | ------------------------------------------------- |
| 23         | 17h | Zen/Zen+/Zen2 | 14/12/7 nm Ryzen(桌面/移动) Epyc(服务器Zen1:Naples Zen2:Rome) | zen2开始多了IO die（12nm）                              |
| 24         | 18h | Hygon Dhyana  |                                                        |                                                   |
| 25         | 19h | Zen3          | 7nm Ryzen 5000  /Milan                                 | 64*zen3 ,8 ddr4,128 pcie4.0                       |
|            |     | Zen4          | 5nm Ryzen 7000 /Genoa                                  | 96*zen4 cores, 12 channel DDR5 ,128 PCIe 5.0 lane |

### 32核 海光一号

计算单元4die 每个die包含8个核心 4个核共享一个8M的L3缓存 每个核独享一个512K的L2缓存 die之间通过XGMI互联 一个32核的处理器支持64M的3级缓存

内存部分每个die 提供2个内存通道 即支持4根内存  一个32核的cpu就支持8个内存通道 16根内存

IO单元支持PCIE SATA  USB I2C等信号

![](2022-07-11-09-21-08-image.png)

特点: 

- 高性能

- 更安全: CPU内置专用安全处理器

cpu内置Boot Rom 提供比传统TPM机制更高级别的安全机制，基于中国SM，3，4算法的Security Boot技术，层次化的逐级认证管理机制

- 通用性:x86    

### 介绍

| Project | XWH                                                                                                                                                                                                                                                                                                                                                                                           |
| ------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| CPU     | 支持ROME/Milan Hygon 最高功耗300w<br/>每个CPU支持8个内存channel，每个通道支持2根DIMM<br/>最大支持4x XGMI CPU互联 ，速率到16Gps<br/>每个CPU支持64lane PCIe G4.0 ，速率16GT/s                                                                                                                                                                                                                                                         |
| Memory  | 支持DDR4  R/LR/NV/3DS DIMM<br/>最大支持2933MHz 2dpc，3200MHz 1dpc                                                                                                                                                                                                                                                                                                                                    |
| PCIE    | CPU0 P0 [8:15] 接SAS/Raid <br/>CPU0 P0 [4:7] 接1X Simline x4 CON<br/>CPU0 P0 [0:3] 接M.2 CON +PCIE 转SAS<br/>CPU0 P1 [8:15] 接OCP<br/>CPU0 P1 [0:7]接1X Simline x8 CON<br/>CPU0 P2[0:15] 接Riser卡 A CON<br/>CPU0 P3[8:15] 接Riser卡 A CON<br/>CPU0 P3[0:7] 接1X Simline x8 CON<br/>CPU1 P0[0:15] 接2X Simline x8 CON<br/>CPU1 P1[0:15] 和CPU1 P2[0:15]接Riser 卡 B CON<br/>CPU1 P3[0:15] 接Riser 卡C CON<br/> |
| SATA    | 2xM.2 与2X PCIe 4.0  x1 from CPU0                                                                                                                                                                                                                                                                                                                                                              |

## 一些规范

![](2022-07-11-20-25-19-image.png)

| USB版本   | 最大传输速率                | 速率称号                                | 最大输出电流   | 推出时间    | 目前官方版本名        |
| ------- | --------------------- | ----------------------------------- | -------- | ------- | -------------- |
| USB1.0  | 1.Mbps(192KB/s)       | 低速 Low Speed                        | 5V/500mA | 1996.1  | USB2.0         |
| USB1.1  | 12Mbps(1.5MB/s)       | 全速 Full Speed                       | 5V/500mA | 1998.9  | USB2.0         |
| USB2.0  | 480Mbps(60MB/s)       | 高速 Hi-Speed                         | 5V/500mA | 2000.4  | USB2.0         |
| USB3.0  | 5Gbps(500MB/s)        | 超高速SuperSpeed                       | 5V/900mA | 2008.11 | USB 3.2 Gen1   |
| USB 3.1 | 10Gbps(1280MB/s)      | 超高速USB 10Gbps SuperSpeed USB 10Gbps | 20V/5A   | 2013.12 | USB 3.2 Gen2x1 |
| USB 3.2 | 20Gbps    2424.24MB/s | 超高速USB 20Gbps SuperSpeed USB 20Gbps |          |         | USB 3.2 Gen2x2 |
| USB 4.0 | 40Gbps    5GB/s       |                                     |          |         |                |

### 内存知识

| DDR SDRAM 标准 | Internal rate （MHz） | Bus clock（MHz） | Prefetch | Date rate(MT/s) | 传输率(GB/s) | 电压(V)    |
| ------------ | ------------------- | -------------- | -------- | --------------- | --------- | -------- |
| SDRAM        | 100-166             | 100-166        | 1n       | 100-166         | 0.8-1.3   | 3.3      |
| DDR          | 133-200             | 133-200        | 2n       | 266-400         | 2.3-3.2   | 2.5/2.6  |
| DDR2         | 133-200             | 266-400        | 4n       | 533-800         | 4.2-6.4   | 1.8      |
| DDR3         | 133-200             | 533-800        | 8n       | 1066-1600       | 8.5-14.9  | 1.35/1.5 |
| DDR4         | 133-200             | 1066-1600      | 8n       | 2133-3200       | 17-21.3   | 1.2      |
| DDR5         |                     | 2400–3600 MHz  |          |                 | 51.2      | 1.1      |

内存信息 1R*16: 说明1个rank，每个芯片device提供16bit内容 

![](2022-07-14-11-35-20-image.png)

![](2022-07-14-11-35-53-image.png)

1个chip当中有8个bank组成,每个bank都有列和行构成 ，提供内存随机按块存取

中间一个格子的存储宽度指的是内存颗粒chip的位宽，在这里由8个Chip组成一个Rank，而CPU寻址宽度是64bit,所以64/8=8bit，即每个格子是1个字节。选择格子也不是简单两个信号决定,是由一系列信号构成.以2GB DDR3为例：

 1.**片选**（Chip Select）信号，S0#和S1#，每个用于选择是哪个Rank。

2. **Bank地址线**，BA0-BA2, 2^3=8,可以选择8个Bank

3. **列选** (Column Address Select), CAS#,用于指示现在要选通列地址。

4. **行选**（Row Address Select），RAS#用于指示现在要选通行地址。

> CAS#和RAS#可能只有一跟信号线. 如果行有效 RAS#低电平，CAS#高电平,在A0-A13传送的是行地址信号.如果列有效，则RAS#高，CAS#低,传送的是列地址

5. **地址线**，A0-A13，用于行和列的地址选择（可并不都用于地址，本处忽略）。

6. **数据线**，DQ0-DQ63，用于提供全64bit的数据。

7. **命令**，COMMAND,用于传输命令，如读或者写等等

#### 时延

**1. CL** 

CAS Latency,指CAS发出后 需要点时间才有数据输出，称为CAS 时延，由于只在读取

出现，又叫读取时延RL

**2. tRCD**      RAS到CAS时延

#### 提高内存速率

1.多通道 : 现代内存控制器一般都移入了CPU内部,并且内存控制器都支持多通道，同一通道颜色不同

2.Interleave ：让同一块内存分布到不同通道

3.Overclock ： 超频

#### 内存地址映射

![](2022-07-19-14-46-58-image.png)

历史内存都很小，32位的地址（4G）空间看起来永远也用不完，低地址被分配给内存用，高地址被分配用来给Memory map IO。为了兼容以前的驱动，这一块就被固定下来。再有内存就只能从4G以上分配了。

##### MMIO内存映射

![](2022-07-19-14-49-35-image.png) 

其中有几块要特别说明一下：

    1.Boot Vector的空间是BIOS内容映射的地址，它的大小是可以调节的，为了满足不同大小的BIOS。

    2.Local APIC是APIC中断模式各个内核local APIC寄存器的映射地址

    3.PCI ECAM 叫做PCIBAR，是PCIe配置地址空间的映射地址。它的起始地址可调,方便4G以下内存大小调整,一般设为64MB 和128MB

    4. High MMIO被BIOS保留作为64位MMIO分配用

### 内存 layout

![](2022-10-27-11-16-10-image.png)

#### 常规内存 CM

系统内存第一个640KB,是标准DOS程序和 DOS驱动 ，常驻内存程序区域.这块RAM可以在实模式下访问。当然也有些不完全归OS或用户使用的区域。如起始1KB是BIOS 中断向量表，随后1KB是BIOS数据区，顶端还有BIOS 扩展数据区，这些在实模式下必须保留。

#### 上位内存区 UMA

系统内存第一个1M内存顶端384KB（1024-640KB）。是系统保留区，一部分用来被系统设备使用（CGA,VGA等），另一部分用作ROM shadowing和驱动

> Shadow ROM/RAM ：通过一组BIOS参数，将ROM区一些内容影射到RAM中提高ROM访问性能

#### 高端内存区 HMA

系统内存第二个 1M 的第一个64KB区域，是扩展内存中唯一可以在实模式下访问的部分，具体看A20 Gate有没有打开

#### 扩展内存

保护模式下才能访问

> Int 15/AX = E820h 可以知道内存layout
